<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿç¡çœ è‡ªæµ‹ - ç¡çœ è´¨é‡è¯„ä¼° | AZ Ringæ™ºèƒ½å¥åº·æˆ’æŒ‡</title>
    <meta name="description" content="5-8åˆ†é’Ÿå¿«é€Ÿè¯„ä¼°æ‚¨çš„ç¡çœ è´¨é‡ï¼ŒåŸºäºå›½é™…ç¡çœ åŒ»å­¦æ ‡å‡†çš„æ™ºèƒ½ç¡çœ å¥åº·è¯„ä¼°ã€‚">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.0.0/css/all.min.css">
    <!-- æœ¬åœ°Interå­—ä½“ -->
    <style>
        @font-face {
            font-family: 'Inter';
            font-style: normal;
            font-weight: 300 700;
            font-display: swap;
            src: url('../fonts/inter-variable.woff2') format('woff2');
        }
        
        :root {
            --oura-black: #0a0a0a;
            --oura-dark: #1a1a1a;
            --oura-gray: #2a2a2a;
            --oura-light-gray: #666666;
            --oura-white: #ffffff;
            --oura-accent: #ff6b35;
            --oura-accent-light: #ff8a65;
            --oura-blue: #4a90e2;
            --oura-green: #7ed321;
            /* ç¡çœ ä¸»é¢˜è‰²å½© */
            --sleep-primary: #2c3e50;
            --sleep-secondary: #3498db;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--sleep-primary) 0%, var(--sleep-secondary) 100%);
            color: white;
            line-height: 1.6;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        /* å…¨å±æ²‰æµ¸å¼å®¹å™¨ */
        .typeform-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            position: relative;
        }
        
        /* åœ†å½¢è¿›åº¦æŒ‡ç¤ºå™¨ */
        .typeform-progress {
            position: fixed;
            top: 40px;
            right: 40px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            z-index: 100;
        }

        .progress-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#ffffff 0deg, transparent 0deg);
            transition: background 0.6s ease;
        }

        .progress-text {
            position: relative;
            z-index: 2;
        }
        
        /* è¿”å›æŒ‰é’® */
        .back-btn {
            position: fixed;
            top: 40px;
            left: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-2px);
        }
        
        /* é—®é¢˜å¹»ç¯ç‰‡ */
        .question-slide {
            display: none;
            text-align: center;
            max-width: 800px;
            width: 100%;
            animation: fadeInUp 0.6s ease;
        }
        
        .question-slide.active {
            display: block;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .question-number {
            font-size: 16px;
            font-weight: 500;
            opacity: 0.8;
            margin-bottom: 24px;
        }
        
        .question-text {
            font-size: 36px;
            font-weight: 300;
            line-height: 1.3;
            margin-bottom: 60px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* æ»‘åŠ¨æ¡æ ·å¼ */
        .slider-container {
            margin: 40px 0 60px;
        }
        
        .slider {
            width: 100%;
            max-width: 500px;
            margin: 0 auto 30px;
            -webkit-appearance: none;
            appearance: none;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            transition: all 0.3s ease;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }
        
        .slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 14px;
            opacity: 1;
            color: white;
            font-weight: 500;
        }
        
        .slider-labels span {
            flex: 1;
            text-align: center;
            padding: 0 8px;
        }
        
        .current-value {
            font-size: 18px;
            font-weight: 600;
            color: white;
            margin-bottom: 20px;
            min-height: 25px;
        }
        
        /* å¯¼èˆªæŒ‰é’® */
        .nav-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
        }
        
        .nav-button {
            padding: 16px 32px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: transparent;
            color: white;
            border-radius: 30px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 120px;
        }
        
        .nav-button:hover {
            border-color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
        }
        
        .nav-button.primary {
            background: white;
            color: var(--sleep-primary);
            border-color: white;
        }
        
        .nav-button.primary:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }
        
        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* ç»“æœé¡µé¢æ ·å¼ */
        .result-container {
            display: none;
            text-align: center;
            max-width: 600px;
            width: 100%;
            animation: fadeInUp 0.8s ease;
        }
        
        .result-container.hidden {
            display: none;
        }
        
        .result-icon {
            font-size: 80px;
            margin-bottom: 32px;
        }
        
        .result-title {
            font-size: 42px;
            font-weight: 300;
            margin-bottom: 24px;
        }
        
        .result-description {
            font-size: 20px;
            line-height: 1.6;
            opacity: 0.9;
            margin-bottom: 48px;
        }
        
        .result-actions {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 16px 32px;
            border-radius: 30px;
            text-decoration: none;
            font-weight: 500;
            font-size: 16px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: white;
            color: var(--sleep-primary);
        }
        
        .btn-primary:hover {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: transparent;
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
        }
        
        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: white;
            transform: translateY(-2px);
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .typeform-container {
                padding: 20px;
            }
            
            .question-text {
                font-size: 28px;
                margin-bottom: 40px;
            }
            
            .typeform-progress,
            .back-btn {
                top: 20px;
            }
            
            .typeform-progress {
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 14px;
            }
            
            .back-btn {
                left: 20px;
                padding: 8px 16px;
                font-size: 12px;
            }
            
            .slider-labels {
                font-size: 12px;
            }
            
            .nav-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .result-actions {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="typeform-container">
        <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <div class="typeform-progress">
            <div class="progress-circle"></div>
            <div class="progress-text">
                <span id="current-progress">1</span>/<span id="total-questions">8</span>
            </div>
        </div>
        
        <!-- è¿”å›æŒ‰é’® -->
        <a href="health-sleep-center.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            è¿”å›
        </a>
        
        <!-- é—®é¢˜å¹»ç¯ç‰‡ -->
        <div id="slide-0" class="question-slide active">
            <div class="question-number">é—®é¢˜ 1 / 8</div>
            <h2 class="question-text">é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦å¤šé•¿æ—¶é—´æ‰èƒ½å…¥ç¡ï¼Ÿ</h2>
            <div class="slider-container">
                <div class="current-value" id="current-value-0">15åˆ†é’Ÿå·¦å³</div>
                <input type="range" class="slider" id="slider-0" min="1" max="5" value="3" 
                       oninput="updateSliderValue(0, this.value)" onchange="selectAnswer(0, this.value)">
                <div class="slider-labels">
                    <span>5åˆ†é’Ÿå†…</span>
                    <span>10-15åˆ†é’Ÿ</span>
                    <span>15-30åˆ†é’Ÿ</span>
                    <span>30-60åˆ†é’Ÿ</span>
                    <span>è¶…è¿‡1å°æ—¶</span>
                </div>
            </div>
            <div class="nav-buttons">
                <button class="nav-button primary" onclick="nextQuestion()">ä¸‹ä¸€é¢˜</button>
            </div>
        </div>
        
        <!-- ç»“æœæ˜¾ç¤º -->
        <div id="result" class="result-container hidden">
            <div class="result-icon" id="resultIcon">ğŸŒ™</div>
            <h2 class="result-title" id="resultTitle">æ‚¨çš„ç¡çœ è´¨é‡è¯„ä¼°</h2>
            <p class="result-description" id="resultDescription">åŸºäºæ‚¨çš„å›ç­”ï¼Œæˆ‘ä»¬ä¸ºæ‚¨åˆ†æå‡ºäº†ç¡çœ è´¨é‡ç‰¹å¾ã€‚</p>
            <div class="result-actions">
                <a href="health-sleep-deep.html" class="action-btn btn-primary">
                    <i class="fas fa-star"></i>
                    è¿›è¡Œæ·±åº¦åˆ†æ
                </a>
                <a href="health-sleep-center.html" class="action-btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    è¿”å›ç¡çœ æµ‹è¯•
                </a>
            </div>
        </div>
    </div>

    <script>
        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(...args) {
            console.log('[Sleep Quick Debug]', ...args);
        }

        // å®‰å…¨è·å–å…ƒç´ 
        function safeGetElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn(`å…ƒç´ æœªæ‰¾åˆ°: ${id}`);
            }
            return element;
        }

        // å…¨å±€é”™è¯¯å¤„ç†
        window.onerror = function(message, source, lineno, colno, error) {
            console.error('é¡µé¢é”™è¯¯:', {
                message: message,
                source: source,
                line: lineno,
                column: colno,
                error: error
            });
            return false;
        };

        // éšè—é—®å·ç›¸å…³å…ƒç´ ä½†ä¿æŒå®¹å™¨å¯è§
        function hideQuestionnaireElements() {
            try {
                const progress = document.querySelector('.typeform-progress');
                if (progress) progress.style.display = 'none';
                const backBtn = document.querySelector('.back-btn');
                if (backBtn) backBtn.style.display = 'none';
                const slides = document.querySelectorAll('.question-slide');
                slides.forEach(slide => {
                    slide.style.display = 'none';
                });
                debugLog('é—®å·å…ƒç´ å·²éšè—');
            } catch (error) {
                console.error('éšè—é—®å·å…ƒç´ æ—¶å‡ºé”™:', error);
            }
        }

        // å¿«é€Ÿç¡çœ è‡ªæµ‹é—®é¢˜æ•°æ®
        const questions = [
            {
                text: "é€šå¸¸æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦å¤šé•¿æ—¶é—´æ‰èƒ½å…¥ç¡ï¼Ÿ",
                labels: ["5åˆ†é’Ÿå†…", "10-15åˆ†é’Ÿ", "15-30åˆ†é’Ÿ", "30-60åˆ†é’Ÿ", "è¶…è¿‡1å°æ—¶"],
                values: [5, 4, 3, 2, 1]
            },
            {
                text: "è¿‡å»ä¸€ä¸ªæœˆï¼Œæ‚¨å¹³å‡æ¯æ™šç¡å‡ ä¸ªå°æ—¶ï¼Ÿ",
                labels: ["ä¸è¶³5å°æ—¶", "5-6å°æ—¶", "6-7å°æ—¶", "7-8å°æ—¶", "è¶…è¿‡8å°æ—¶"],
                values: [1, 2, 3, 5, 4]
            },
            {
                text: "æ‚¨åœ¨å¤œé—´é†’æ¥çš„é¢‘ç‡å¦‚ä½•ï¼Ÿ",
                labels: ["ä»ä¸é†’æ¥", "å¾ˆå°‘é†’æ¥", "å¶å°”é†’æ¥", "ç»å¸¸é†’æ¥", "æ€»æ˜¯é†’æ¥"],
                values: [5, 4, 3, 2, 1]
            },
            {
                text: "æ‚¨å¯¹è‡ªå·±çš„ç¡çœ æ·±åº¦æ„Ÿè§‰å¦‚ä½•ï¼Ÿ",
                labels: ["å¾ˆæµ…", "è¾ƒæµ…", "ä¸€èˆ¬", "è¾ƒæ·±", "å¾ˆæ·±"],
                values: [1, 2, 3, 4, 5]
            },
            {
                text: "æ—©ä¸Šé†’æ¥æ—¶ï¼Œæ‚¨çš„ç²¾ç¥çŠ¶æ€å¦‚ä½•ï¼Ÿ",
                labels: ["å¾ˆç–²æƒ«", "è¾ƒç–²æƒ«", "ä¸€èˆ¬", "è¾ƒç²¾ç¥", "å¾ˆç²¾ç¥"],
                values: [1, 2, 3, 4, 5]
            },
            {
                text: "ç™½å¤©æ‚¨æ„Ÿåˆ°å›°å€¦çš„é¢‘ç‡ï¼Ÿ",
                labels: ["ä»ä¸å›°å€¦", "å¾ˆå°‘å›°å€¦", "å¶å°”å›°å€¦", "ç»å¸¸å›°å€¦", "æ€»æ˜¯å›°å€¦"],
                values: [5, 4, 3, 2, 1]
            },
            {
                text: "æ‚¨å¯¹ç›®å‰ç¡çœ è´¨é‡çš„æ•´ä½“æ»¡æ„åº¦ï¼Ÿ",
                labels: ["å¾ˆä¸æ»¡æ„", "ä¸å¤ªæ»¡æ„", "ä¸€èˆ¬", "æ¯”è¾ƒæ»¡æ„", "å¾ˆæ»¡æ„"],
                values: [1, 2, 3, 4, 5]
            },
            {
                text: "ç¡çœ é—®é¢˜å¯¹æ‚¨æ—¥å¸¸ç”Ÿæ´»çš„å½±å“ç¨‹åº¦ï¼Ÿ",
                labels: ["ä¸¥é‡å½±å“", "æ˜æ˜¾å½±å“", "è½»å¾®å½±å“", "å¾ˆå°‘å½±å“", "å®Œå…¨ä¸å½±å“"],
                values: [1, 2, 3, 4, 5]
            }
        ];

        let currentQuestion = 0;
        let answers = [];
        
        // ä¿å­˜è¿›åº¦åˆ°localStorage
        function saveProgress() {
            try {
                const progressData = {
                    currentQuestion: currentQuestion,
                    answers: answers,
                    timestamp: new Date().toISOString(),
                    completed: false
                };
                localStorage.setItem('sleepQuickAssessmentProgress', JSON.stringify(progressData));
                debugLog('è¿›åº¦å·²ä¿å­˜', progressData);
            } catch (error) {
                console.warn('ä¿å­˜è¿›åº¦å¤±è´¥:', error);
            }
        }

        // ä»localStorageæ¢å¤è¿›åº¦
        function restoreProgress() {
            try {
                const savedProgress = localStorage.getItem('sleepQuickAssessmentProgress');
                if (savedProgress) {
                    const progressData = JSON.parse(savedProgress);
                    debugLog('æ‰¾åˆ°ä¿å­˜çš„è¿›åº¦', progressData);
                    
                    // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ
                    if (progressData.completed) {
                        debugLog('æµ‹è¯•å·²å®Œæˆï¼Œæ˜¾ç¤ºç»“æœé€‰é¡¹');
                        if (confirm('æ‚¨å·²å®Œæˆè¿‡è¿™ä¸ªç¡çœ æµ‹è¯•ï¼Œæ˜¯å¦æŸ¥çœ‹ä¹‹å‰çš„ç»“æœï¼Ÿ\nç‚¹å‡»"ç¡®å®š"æŸ¥çœ‹ç»“æœï¼Œç‚¹å‡»"å–æ¶ˆ"é‡æ–°å¼€å§‹æµ‹è¯•ã€‚')) {
                            showPreviousResult();
                            return true;
                        } else {
                            // æ¸…é™¤æ—§æ•°æ®é‡æ–°å¼€å§‹
                            localStorage.removeItem('sleepQuickAssessmentProgress');
                            localStorage.removeItem('sleepQuickAssessmentResult');
                            return false;
                        }
                    }
                    
                    // æ¢å¤æœªå®Œæˆçš„è¿›åº¦
                    if (progressData.answers && progressData.currentQuestion !== undefined) {
                        if (confirm(`å‘ç°æœªå®Œæˆçš„ç¡çœ æµ‹è¯•ï¼ˆè¿›åº¦ï¼š${progressData.currentQuestion + 1}/${questions.length}ï¼‰ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ\nç‚¹å‡»"ç¡®å®š"ç»§ç»­æµ‹è¯•ï¼Œç‚¹å‡»"å–æ¶ˆ"é‡æ–°å¼€å§‹ã€‚`)) {
                            currentQuestion = Math.min(progressData.currentQuestion, questions.length - 1);
                            answers = progressData.answers || [];
                            
                            // ç¡®ä¿ç­”æ¡ˆæ•°ç»„é•¿åº¦æ­£ç¡®
                            while (answers.length < questions.length) {
                                answers.push(3); // é»˜è®¤å€¼
                            }
                            
                            debugLog('è¿›åº¦å·²æ¢å¤', {currentQuestion, answers});
                            return true;
                        } else {
                            localStorage.removeItem('sleepQuickAssessmentProgress');
                            return false;
                        }
                    }
                }
                return false;
            } catch (error) {
                console.warn('æ¢å¤è¿›åº¦å¤±è´¥:', error);
                localStorage.removeItem('sleepQuickAssessmentProgress');
                return false;
            }
        }

        // æ˜¾ç¤ºä¹‹å‰çš„ç»“æœ
        function showPreviousResult() {
            try {
                const savedResult = localStorage.getItem('sleepQuickAssessmentResult');
                if (savedResult) {
                    const resultData = JSON.parse(savedResult);
                    debugLog('æ˜¾ç¤ºä¿å­˜çš„ç»“æœ', resultData);
                    
                    // éšè—é—®å·ç›¸å…³å…ƒç´ ï¼Œä½†ä¿æŒå®¹å™¨å¯è§
                    hideQuestionnaireElements();
                    
                    const resultContainer = safeGetElement('result');
                    if (resultContainer) {
                        resultContainer.classList.remove('hidden');
                        resultContainer.style.display = 'block'; // ç¡®ä¿æ˜¾ç¤º
                    } else {
                        throw new Error('ç»“æœå®¹å™¨æœªæ‰¾åˆ°');
                    }
                    
                    // æ›´æ–°ç»“æœæ˜¾ç¤º
                    const resultIcon = safeGetElement('resultIcon');
                    const resultTitle = safeGetElement('resultTitle');
                    const resultDescription = safeGetElement('resultDescription');
                    
                    if (resultIcon) resultIcon.textContent = resultData.result.icon;
                    if (resultTitle) resultTitle.textContent = resultData.result.title;
                    if (resultDescription) resultDescription.textContent = resultData.result.description;
                    
                    debugLog('ç»“æœæ˜¾ç¤ºå…ƒç´ æ›´æ–°å®Œæˆ');
                }
            } catch (error) {
                console.error('æ˜¾ç¤ºä¹‹å‰ç»“æœå¤±è´¥:', error);
                alert('æ— æ³•æ˜¾ç¤ºä¹‹å‰çš„ç»“æœï¼Œè¯·é‡æ–°æµ‹è¯•');
            }
        }

        // åˆå§‹åŒ–
        function init() {
            debugLog('å¼€å§‹åˆå§‹åŒ–');
            
            // å°è¯•æ¢å¤è¿›åº¦
            const restored = restoreProgress();
            
            if (!restored) {
                // åˆå§‹åŒ–ç­”æ¡ˆæ•°ç»„
                answers = new Array(questions.length).fill(3);
                debugLog('åˆå§‹åŒ–ç­”æ¡ˆæ•°ç»„', answers);
            }
            
            // ç”Ÿæˆæ‰€æœ‰é—®é¢˜å¹»ç¯ç‰‡
            generateSlides();
            
            // æ›´æ–°æ˜¾ç¤º
            updateQuestionDisplay();
            updateProgress();
            
            debugLog('åˆå§‹åŒ–å®Œæˆ');
        }

        // ç”Ÿæˆé—®é¢˜å¹»ç¯ç‰‡
        function generateSlides() {
            const container = document.querySelector('.typeform-container');
            
            // æ¸…é™¤é™¤äº†ç¬¬ä¸€ä¸ªå¹»ç¯ç‰‡å¤–çš„æ‰€æœ‰å¹»ç¯ç‰‡
            const existingSlides = document.querySelectorAll('.question-slide');
            for (let i = 1; i < existingSlides.length; i++) {
                existingSlides[i].remove();
            }
            
            // ç”Ÿæˆå‰©ä½™çš„å¹»ç¯ç‰‡
            for (let i = 1; i < questions.length; i++) {
                const slide = document.createElement('div');
                slide.id = `slide-${i}`;
                slide.className = 'question-slide';
                
                slide.innerHTML = `
                    <div class="question-number">é—®é¢˜ ${i + 1} / ${questions.length}</div>
                    <h2 class="question-text">${questions[i].text}</h2>
                    <div class="slider-container">
                        <div class="current-value" id="current-value-${i}">${questions[i].labels[2]}</div>
                        <input type="range" class="slider" id="slider-${i}" min="1" max="5" value="3" 
                               oninput="updateSliderValue(${i}, this.value)" onchange="selectAnswer(${i}, this.value)">
                        <div class="slider-labels">
                            ${questions[i].labels.map(label => `<span>${label}</span>`).join('')}
                        </div>
                    </div>
                    <div class="nav-buttons">
                        <button class="nav-button" onclick="prevQuestion()">ä¸Šä¸€é¢˜</button>
                        <button class="nav-button primary" onclick="${i === questions.length - 1 ? 'showResult()' : 'nextQuestion()'}">${i === questions.length - 1 ? 'æŸ¥çœ‹ç»“æœ' : 'ä¸‹ä¸€é¢˜'}</button>
                    </div>
                `;
                
                container.insertBefore(slide, document.getElementById('result'));
            }
            
            // æ›´æ–°æ€»é—®é¢˜æ•°æ˜¾ç¤º
            const totalElement = safeGetElement('total-questions');
            if (totalElement) {
                totalElement.textContent = questions.length;
            }
        }

        // æ›´æ–°æ»‘åŠ¨æ¡æ˜¾ç¤ºå€¼
        function updateSliderValue(questionIndex, value) {
            const currentValueElement = safeGetElement(`current-value-${questionIndex}`);
            if (currentValueElement && questions[questionIndex]) {
                currentValueElement.textContent = questions[questionIndex].labels[value - 1];
            }
        }

        // é€‰æ‹©ç­”æ¡ˆ
        function selectAnswer(questionIndex, value) {
            answers[questionIndex] = parseInt(value);
            updateSliderValue(questionIndex, value);
            saveProgress();
            debugLog(`é—®é¢˜ ${questionIndex + 1} ç­”æ¡ˆ: ${value}`);
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            if (currentQuestion < questions.length - 1) {
                // éšè—å½“å‰é—®é¢˜
                const currentSlide = safeGetElement(`slide-${currentQuestion}`);
                if (currentSlide) currentSlide.classList.remove('active');
                
                currentQuestion++;
                
                // æ˜¾ç¤ºä¸‹ä¸€é¢˜
                const nextSlide = safeGetElement(`slide-${currentQuestion}`);
                if (nextSlide) nextSlide.classList.add('active');
                
                updateProgress();
                updateQuestionDisplay();
                saveProgress();
            }
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            if (currentQuestion > 0) {
                // éšè—å½“å‰é—®é¢˜
                const currentSlide = safeGetElement(`slide-${currentQuestion}`);
                if (currentSlide) currentSlide.classList.remove('active');
                
                currentQuestion--;
                
                // æ˜¾ç¤ºä¸Šä¸€é¢˜
                const prevSlide = safeGetElement(`slide-${currentQuestion}`);
                if (prevSlide) prevSlide.classList.add('active');
                
                updateProgress();
                updateQuestionDisplay();
                saveProgress();
            }
        }

        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            const progressElement = safeGetElement('current-progress');
            if (progressElement) {
                progressElement.textContent = currentQuestion + 1;
            }
            
            // æ›´æ–°åœ†å½¢è¿›åº¦
            const progressCircle = document.querySelector('.progress-circle');
            if (progressCircle) {
                const percentage = ((currentQuestion + 1) / questions.length) * 360;
                progressCircle.style.background = `conic-gradient(#ffffff ${percentage}deg, transparent ${percentage}deg)`;
            }
        }

        // æ›´æ–°é—®é¢˜æ˜¾ç¤ºçŠ¶æ€
        function updateQuestionDisplay() {
            // æ¢å¤æ»‘åŠ¨æ¡çš„å€¼
            if (answers[currentQuestion] !== undefined) {
                const slider = safeGetElement(`slider-${currentQuestion}`);
                if (slider) {
                    slider.value = answers[currentQuestion];
                    updateSliderValue(currentQuestion, answers[currentQuestion]);
                }
            }
        }

        // è®¡ç®—ç¡çœ è´¨é‡è¯„åˆ†
        function calculateSleepQuality() {
            try {
                debugLog('å¼€å§‹è®¡ç®—ç¡çœ è´¨é‡', answers);
                
                // è¿‡æ»¤æœ‰æ•ˆç­”æ¡ˆ
                const validAnswers = answers.filter(answer => answer !== undefined && answer !== null);
                
                if (validAnswers.length === 0) {
                    console.warn('æ²¡æœ‰æœ‰æ•ˆç­”æ¡ˆ');
                    return {
                        score: 0,
                        level: 'æœªè¯„ä¼°',
                        icon: 'â“',
                        title: 'è¯„ä¼°æœªå®Œæˆ',
                        description: 'è¯·å®Œæˆæ‰€æœ‰é—®é¢˜åå†æŸ¥çœ‹ç»“æœã€‚'
                    };
                }
                
                // è®¡ç®—åŠ æƒæ€»åˆ†
                let totalScore = 0;
                let maxScore = 0;
                
                for (let i = 0; i < Math.min(validAnswers.length, questions.length); i++) {
                    const questionValue = questions[i].values[validAnswers[i] - 1] || validAnswers[i];
                    totalScore += questionValue;
                    maxScore += 5;
                }
                
                // è½¬æ¢ä¸ºç™¾åˆ†åˆ¶
                const finalScore = Math.round((totalScore / maxScore) * 100);
                
                debugLog('ç¡çœ è´¨é‡è®¡ç®—ç»“æœ', {
                    totalScore,
                    maxScore,
                    finalScore,
                    validAnswers: validAnswers.length
                });
                
                // ç¡çœ è´¨é‡ç­‰çº§åˆ¤å®š
                let level, icon, title, description;
                
                if (finalScore >= 85) {
                    level = 'ä¼˜ç§€';
                    icon = 'ğŸŒŸ';
                    title = 'ç¡çœ è´¨é‡ä¼˜ç§€';
                    description = 'æ­å–œï¼æ‚¨çš„ç¡çœ è´¨é‡éå¸¸å¥½ï¼Œè¯·ä¿æŒè‰¯å¥½çš„ç¡çœ ä¹ æƒ¯ã€‚å»ºè®®ç»§ç»­ç»´æŒè§„å¾‹ä½œæ¯ï¼Œé€‚åº¦è¿åŠ¨ï¼Œè¥é€ è‰¯å¥½çš„ç¡çœ ç¯å¢ƒã€‚';
                } else if (finalScore >= 70) {
                    level = 'è‰¯å¥½';
                    icon = 'ğŸ˜Š';
                    title = 'ç¡çœ è´¨é‡è‰¯å¥½';
                    description = 'æ‚¨çš„ç¡çœ è´¨é‡æ€»ä½“è‰¯å¥½ï¼Œä½†ä»æœ‰æ”¹å–„ç©ºé—´ã€‚å»ºè®®å…³æ³¨ç¡å‰æ”¾æ¾ã€å‡å°‘ç”µå­è®¾å¤‡ä½¿ç”¨ï¼Œä¼˜åŒ–ç¡çœ ç¯å¢ƒæ¸©åº¦å’Œå…‰çº¿ã€‚';
                } else if (finalScore >= 55) {
                    level = 'ä¸€èˆ¬';
                    icon = 'ğŸ˜';
                    title = 'ç¡çœ è´¨é‡ä¸€èˆ¬';
                    description = 'æ‚¨çš„ç¡çœ è´¨é‡å¤„äºä¸­ç­‰æ°´å¹³ï¼Œå»ºè®®è°ƒæ•´ä½œæ¯æ—¶é—´ï¼Œå»ºç«‹å›ºå®šçš„ç¡å‰ä¾‹è¡Œç¨‹åºï¼Œé¿å…å’–å•¡å› å’Œå¤§é¤å½±å“ç¡çœ ã€‚';
                } else if (finalScore >= 40) {
                    level = 'è¾ƒå·®';
                    icon = 'ğŸ˜Ÿ';
                    title = 'ç¡çœ è´¨é‡è¾ƒå·®';
                    description = 'æ‚¨çš„ç¡çœ è´¨é‡éœ€è¦æ”¹å–„ã€‚å»ºè®®å’¨è¯¢åŒ»ç”Ÿæ’é™¤ç¡çœ éšœç¢ï¼ŒåŒæ—¶æ”¹å–„ç¡çœ ç¯å¢ƒï¼Œå­¦ä¹ æ”¾æ¾æŠ€å·§ï¼Œè€ƒè™‘è®¤çŸ¥è¡Œä¸ºç–—æ³•ã€‚';
                } else {
                    level = 'å¾ˆå·®';
                    icon = 'ğŸ˜´';
                    title = 'ç¡çœ è´¨é‡å¾ˆå·®';
                    description = 'æ‚¨çš„ç¡çœ è´¨é‡å­˜åœ¨æ˜æ˜¾é—®é¢˜ï¼Œå¼ºçƒˆå»ºè®®å’¨è¯¢ç¡çœ ä¸“ç§‘åŒ»ç”Ÿã€‚å¯èƒ½éœ€è¦è¿›è¡Œè¯¦ç»†çš„ç¡çœ ç›‘æµ‹å’Œä¸“ä¸šæ²»ç–—ã€‚';
                }
                
                return {
                    score: finalScore,
                    level,
                    icon,
                    title,
                    description
                };
                
            } catch (error) {
                console.error('è®¡ç®—ç¡çœ è´¨é‡æ—¶å‡ºé”™:', error);
                return {
                    score: 0,
                    level: 'è®¡ç®—é”™è¯¯',
                    icon: 'âš ï¸',
                    title: 'è¯„ä¼°å‡ºé”™',
                    description: 'æŠ±æ­‰ï¼Œè®¡ç®—è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡æ–°æµ‹è¯•ã€‚'
                };
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            try {
                debugLog('å¼€å§‹æ˜¾ç¤ºç»“æœ');
                
                // è®¡ç®—ç¡çœ è´¨é‡
                const result = calculateSleepQuality();
                debugLog('ç¡çœ è´¨é‡è¯„ä¼°ç»“æœ', result);
                
                // ä¿å­˜ç»“æœ
                const resultData = {
                    result: result,
                    answers: answers,
                    timestamp: new Date().toISOString()
                };
                
                localStorage.setItem('sleepQuickAssessmentResult', JSON.stringify(resultData));
                
                // æ ‡è®°ä¸ºå·²å®Œæˆ
                const progressData = {
                    currentQuestion: questions.length - 1,
                    answers: answers,
                    timestamp: new Date().toISOString(),
                    completed: true
                };
                localStorage.setItem('sleepQuickAssessmentProgress', JSON.stringify(progressData));
                
                // éšè—é—®å·å…ƒç´ 
                hideQuestionnaireElements();
                
                // æ˜¾ç¤ºç»“æœ
                const resultContainer = safeGetElement('result');
                if (!resultContainer) {
                    throw new Error('ç»“æœå®¹å™¨æœªæ‰¾åˆ°');
                }
                
                resultContainer.classList.remove('hidden');
                resultContainer.style.display = 'block';
                
                // æ›´æ–°ç»“æœå†…å®¹
                const resultIcon = safeGetElement('resultIcon');
                const resultTitle = safeGetElement('resultTitle');
                const resultDescription = safeGetElement('resultDescription');
                
                if (resultIcon) resultIcon.textContent = result.icon;
                if (resultTitle) resultTitle.textContent = result.title;
                if (resultDescription) resultDescription.textContent = result.description;
                
                debugLog('ç»“æœæ˜¾ç¤ºå®Œæˆ');
                
            } catch (error) {
                console.error('æ˜¾ç¤ºç»“æœæ—¶å‡ºé”™:', error);
                alert('æ˜¾ç¤ºç»“æœæ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡æ–°æµ‹è¯•');
            }
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
