<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿç­›æŸ¥ - ä¸­åŒ»ä½“è´¨è‡ªæµ‹ | AZ Ringæ™ºèƒ½å¥åº·æˆ’æŒ‡</title>
    <meta name="description" content="2-3åˆ†é’Ÿå¿«é€Ÿäº†è§£æ‚¨çš„åŸºæœ¬ä½“è´¨ç±»å‹ï¼ŒåŸºäºä¼ ç»Ÿä¸­åŒ»ä½“è´¨å­¦ç†è®ºçš„æ™ºèƒ½å¥åº·è¯„ä¼°ã€‚">
    
    <!-- æ ·å¼æ–‡ä»¶ -->
    <link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/6.0.0/css/all.min.css">
    <!-- æœ¬åœ°Interå­—ä½“ -->
    <style>
        @font-face {
            font-family: 'Inter';
            font-style: normal;
            font-weight: 300 700;
            font-display: swap;
            src: url('../fonts/inter-variable.woff2') format('woff2');
        }
        
        :root {
            --oura-black: #0a0a0a;
            --oura-dark: #1a1a1a;
            --oura-gray: #2a2a2a;
            --oura-light-gray: #666666;
            --oura-white: #ffffff;
            --oura-accent: #ff6b35;
            --oura-accent-light: #ff8a65;
            --oura-blue: #4a90e2;
            --oura-green: #7ed321;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            line-height: 1.6;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }
        
        /* å…¨å±æ²‰æµ¸å¼å®¹å™¨ */
        .typeform-container {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            position: relative;
        }
        
        /* åœ†å½¢è¿›åº¦æŒ‡ç¤ºå™¨ */
        .typeform-progress {
            position: fixed;
            top: 40px;
            right: 40px;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: 600;
            z-index: 100;
        }

        .progress-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background: conic-gradient(#ffffff 0deg, transparent 0deg);
            transition: background 0.6s ease;
        }

        .progress-text {
            position: relative;
            z-index: 2;
        }
        
        /* è¿”å›æŒ‰é’® */
        .back-btn {
            position: fixed;
            top: 40px;
            left: 40px;
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }
        
        /* é—®é¢˜å®¹å™¨ */
        .question-slide {
            display: none;
            text-align: center;
            max-width: 800px;
            width: 100%;
            animation: fadeInUp 0.6s ease;
        }

        .question-slide.active {
            display: block;
        }

        /* å¤§å­—ä½“é—®é¢˜ */
        .typeform-question {
            font-size: 48px;
            font-weight: 300;
            margin-bottom: 20px;
            line-height: 1.2;
        }

        .typeform-subtitle {
            font-size: 20px;
            opacity: 0.8;
            margin-bottom: 60px;
            font-weight: 300;
        }
        
        /* æ»‘åŠ¨æ¡å®¹å™¨æ ·å¼ */
        .slider-container {
            margin: 40px 0;
        }

        .custom-slider {
            width: 100%;
            max-width: 600px;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.3);
            outline: none;
            -webkit-appearance: none;
            margin: 40px 0;
            cursor: pointer;
        }

        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease;
        }

        .custom-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
        }

        .custom-slider::-moz-range-thumb {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        }
        
        /* æ»‘åŠ¨æ¡æ ‡ç­¾ */
        .slider-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
            font-size: 14px;
            opacity: 1;
            color: white;
            font-weight: 500;
        }

        .slider-labels span {
            color: white;
            font-weight: 500;
            font-size: 14px;
            text-align: center;
            flex: 1;
        }

        /* å½“å‰å€¼æ˜¾ç¤º */
        .current-value {
            font-size: 24px;
            font-weight: 600;
            margin: 30px 0;
            min-height: 32px;
            color: white;
        }
        
        /* å¯¼èˆªæŒ‰é’® */
        .navigation {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 40px;
            margin-top: 60px;
        }

        .nav-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .nav-button:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
            transform: translateY(-2px);
        }

        .nav-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-button.primary {
            background: white;
            color: #667eea;
            border-color: white;
        }

        .nav-button.primary:hover:not(:disabled) {
            background: rgba(255, 255, 255, 0.9);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .slider-container {
            margin-bottom: 20px;
        }
        
        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.2);
            outline: none;
            -webkit-appearance: none;
            margin-bottom: 20px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #7ed321;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(126, 211, 33, 0.4);
        }
        
        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #7ed321;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 12px rgba(126, 211, 33, 0.4);
        }
        
        .slider-labels {
            display: flex;
            justify-content: space-between;
            color: var(--oura-light-gray);
            font-size: 14px;
        }
        
        .slider-value {
            text-align: center;
            margin-top: 16px;
            font-size: 18px;
            font-weight: 500;
            color: #7ed321;
        }
        
        .navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 40px;
        }
        
        .nav-btn {
            padding: 14px 28px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-prev {
            background: rgba(255, 255, 255, 0.1);
            color: var(--oura-white);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-prev:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-next {
            background: #7ed321;
            color: var(--oura-white);
            border: 2px solid #7ed321;
        }
        
        .btn-next:hover {
            background: #6bb31a;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(126, 211, 33, 0.3);
        }
        
        .btn-next:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .question-info {
            text-align: center;
            color: var(--oura-light-gray);
            font-size: 14px;
        }
        
        /* ç»“æœé¡µé¢æ ·å¼ */
        .result-container {
            display: block;
            text-align: center;
            padding: 40px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            margin: 0 auto;
            max-width: 600px;
        }
        
        .result-icon {
            font-size: 80px;
            margin-bottom: 24px;
        }
        
        .result-title {
            font-size: 32px;
            font-weight: 600;
            margin-bottom: 16px;
        }
        
        .result-description {
            font-size: 18px;
            color: var(--oura-light-gray);
            line-height: 1.6;
            margin-bottom: 30px;
        }
        
        .result-actions {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 24px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: var(--oura-accent);
            color: var(--oura-white);
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--oura-white);
            border: 2px solid rgba(255, 255, 255, 0.2);
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px 16px;
            }
            
            .title {
                font-size: 28px;
            }
            
            .question-container {
                padding: 30px 20px;
            }
            
            .question-text {
                font-size: 20px;
            }
            
            .result-actions {
                flex-direction: column;
                align-items: center;
            }
        }

        /* åŠ¨ç”» */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Typeformå“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .typeform-progress {
                top: 20px;
                right: 20px;
                width: 60px;
                height: 60px;
                font-size: 14px;
            }

            .back-btn {
                top: 20px;
                left: 20px;
                padding: 10px 16px;
                font-size: 14px;
            }

            .typeform-question {
                font-size: 32px;
            }

            .typeform-subtitle {
                font-size: 18px;
                margin-bottom: 40px;
            }

            .navigation {
                gap: 20px;
                margin-top: 40px;
            }

            .nav-button {
                padding: 14px 24px;
                font-size: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="typeform-container">
        <!-- è¿›åº¦æŒ‡ç¤ºå™¨ -->
        <div class="typeform-progress">
            <div class="progress-circle" id="progressCircle"></div>
            <div class="progress-text" id="progressText">1/12</div>
        </div>

        <!-- è¿”å›æŒ‰é’® -->
        <a href="health-tcm-constitution.html" class="back-btn">
            <i class="fas fa-arrow-left"></i>
            è¿”å›
        </a>

        <!-- é—®é¢˜å¹»ç¯ç‰‡ -->
        <div class="question-slide active" id="slide-0">
            <h1 class="typeform-question">æ‚¨å¹³æ—¶çš„ç²¾ç¥çŠ¶æ€å¦‚ä½•ï¼Ÿ</h1>
            <p class="typeform-subtitle">è¯·æ ¹æ®æ‚¨æœ€è¿‘ä¸€ä¸ªæœˆçš„å®é™…æƒ…å†µä½œç­”</p>
            
            <div class="slider-container">
                <input type="range" min="1" max="5" value="3" class="custom-slider" id="slider-0">
                <div class="slider-labels">
                    <span>æ€»æ˜¯ç–²å€¦</span>
                    <span>ç»å¸¸ç–²å€¦</span>
                    <span>ä¸€èˆ¬</span>
                    <span>ç²¾åŠ›å……æ²›</span>
                    <span>ç²¾åŠ›æ—ºç››</span>
                </div>
                <div class="current-value" id="value-0">ä¸€èˆ¬</div>
            </div>

            <div class="navigation">
                <button class="nav-button" id="prevBtn" style="visibility: hidden;" onclick="prevQuestion()">
                    <i class="fas fa-arrow-left"></i>
                    ä¸Šä¸€é¢˜
                </button>
                <button class="nav-button primary" id="nextBtn" onclick="nextQuestion()">
                    ä¸‹ä¸€é¢˜
                    <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>

        <!-- å…¶ä»–é—®é¢˜å¹»ç¯ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        
        <div id="result" class="result-container hidden">
            <div class="result-icon" id="resultIcon">ğŸŒŸ</div>
            <h2 class="result-title" id="resultTitle">æ‚¨çš„ä½“è´¨ç±»å‹</h2>
            <p class="result-description" id="resultDescription">åŸºäºæ‚¨çš„å›ç­”ï¼Œæˆ‘ä»¬ä¸ºæ‚¨åˆ†æå‡ºäº†åˆæ­¥çš„ä½“è´¨ç‰¹å¾ã€‚</p>
            <div class="result-actions">
                <a href="health-standard.html" class="action-btn btn-primary">
                    <i class="fas fa-microscope"></i>
                    è¿›è¡Œè¯¦ç»†è¯„ä¼°
                </a>
                <a href="health-tcm-constitution.html" class="action-btn btn-secondary">
                    <i class="fas fa-arrow-left"></i>
                    è¿”å›ä½“è´¨æµ‹è¯•
                </a>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€é”™è¯¯å¤„ç†
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('é—®å·é¡µé¢é”™è¯¯:', msg, 'at', url, ':', lineNo);
            alert('é¡µé¢å‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + msg);
            return false;
        };

        // è°ƒè¯•æ—¥å¿—å‡½æ•°
        function debugLog(message, data = null) {
            console.log('[å¿«é€Ÿç­›æŸ¥]', message, data || '');
        }

        // å®‰å…¨çš„DOMå…ƒç´ è·å–
        function safeGetElement(id) {
            const element = document.getElementById(id);
            if (!element) {
                console.warn('DOMå…ƒç´ æœªæ‰¾åˆ°:', id);
            }
            return element;
        }

        debugLog('é¡µé¢è„šæœ¬å¼€å§‹åŠ è½½');

        // éšè—é—®å·ç›¸å…³å…ƒç´ ä½†ä¿æŒå®¹å™¨å¯è§
        function hideQuestionnaireElements() {
            try {
                // éšè—è¿›åº¦æŒ‡ç¤ºå™¨
                const progress = document.querySelector('.typeform-progress');
                if (progress) progress.style.display = 'none';
                
                // éšè—è¿”å›æŒ‰é’®
                const backBtn = document.querySelector('.back-btn');
                if (backBtn) backBtn.style.display = 'none';
                
                // éšè—æ‰€æœ‰é—®é¢˜å¹»ç¯ç‰‡
                const slides = document.querySelectorAll('.question-slide');
                slides.forEach(slide => {
                    slide.style.display = 'none';
                });
                
                debugLog('é—®å·å…ƒç´ å·²éšè—');
            } catch (error) {
                console.error('éšè—é—®å·å…ƒç´ æ—¶å‡ºé”™:', error);
            }
        }

        // å¿«é€Ÿç­›æŸ¥é—®é¢˜æ•°æ®
        const questions = [
            {
                text: "æ‚¨å¹³æ—¶çš„ç²¾ç¥çŠ¶æ€å¦‚ä½•ï¼Ÿ",
                labels: ["æ€»æ˜¯ç–²å€¦", "ç»å¸¸ç–²å€¦", "ä¸€èˆ¬", "ç²¾åŠ›å……æ²›", "ç²¾åŠ›æ—ºç››"],
                values: ["å¾ˆå·®", "è¾ƒå·®", "ä¸€èˆ¬", "è¾ƒå¥½", "å¾ˆå¥½"]
            },
            {
                text: "æ‚¨çš„ç¡çœ è´¨é‡æ€ä¹ˆæ ·ï¼Ÿ",
                labels: ["ç»å¸¸å¤±çœ ", "å¶å°”å¤±çœ ", "ä¸€èˆ¬", "ç¡çœ è‰¯å¥½", "ç¡çœ å¾ˆå¥½"],
                values: ["å¾ˆå·®", "è¾ƒå·®", "ä¸€èˆ¬", "è¾ƒå¥½", "å¾ˆå¥½"]
            },
            {
                text: "æ‚¨å¹³æ—¶æ€•å†·è¿˜æ˜¯æ€•çƒ­ï¼Ÿ",
                labels: ["å¾ˆæ€•å†·", "æ€•å†·", "æ­£å¸¸", "æ€•çƒ­", "å¾ˆæ€•çƒ­"],
                values: ["å¾ˆæ€•å†·", "æ€•å†·", "æ­£å¸¸", "æ€•çƒ­", "å¾ˆæ€•çƒ­"]
            },
            {
                text: "æ‚¨çš„é£Ÿæ¬²å¦‚ä½•ï¼Ÿ",
                labels: ["é£Ÿæ¬²ä¸æŒ¯", "é£Ÿæ¬²è¾ƒå·®", "æ­£å¸¸", "é£Ÿæ¬²è‰¯å¥½", "é£Ÿæ¬²æ—ºç››"],
                values: ["å¾ˆå·®", "è¾ƒå·®", "ä¸€èˆ¬", "è¾ƒå¥½", "å¾ˆå¥½"]
            },
            {
                text: "æ‚¨å®¹æ˜“å‡ºæ±—å—ï¼Ÿ",
                labels: ["å¾ˆå°‘å‡ºæ±—", "è¾ƒå°‘å‡ºæ±—", "æ­£å¸¸", "å®¹æ˜“å‡ºæ±—", "æ€»æ˜¯å‡ºæ±—"],
                values: ["å¾ˆå°‘", "è¾ƒå°‘", "ä¸€èˆ¬", "è¾ƒå¤š", "å¾ˆå¤š"]
            },
            {
                text: "æ‚¨çš„å¤§ä¾¿æƒ…å†µå¦‚ä½•ï¼Ÿ",
                labels: ["ç»å¸¸ä¾¿ç§˜", "å¶å°”ä¾¿ç§˜", "æ­£å¸¸", "å¶å°”è…¹æ³»", "ç»å¸¸è…¹æ³»"],
                values: ["å¾ˆå¹²", "è¾ƒå¹²", "æ­£å¸¸", "è¾ƒç¨€", "å¾ˆç¨€"]
            },
            {
                text: "æ‚¨å¹³æ—¶çš„æƒ…ç»ªçŠ¶æ€ï¼Ÿ",
                labels: ["ç»å¸¸ç„¦è™‘", "å¶å°”ç„¦è™‘", "ä¸€èˆ¬", "å¿ƒæƒ…è¾ƒå¥½", "å¿ƒæƒ…æ„‰å¿«"],
                values: ["å¾ˆå·®", "è¾ƒå·®", "ä¸€èˆ¬", "è¾ƒå¥½", "å¾ˆå¥½"]
            },
            {
                text: "æ‚¨å¯¹å¤©æ°”å˜åŒ–çš„ååº”ï¼Ÿ",
                labels: ["å¾ˆæ•æ„Ÿ", "è¾ƒæ•æ„Ÿ", "ä¸€èˆ¬", "ä¸å¤ªæ•æ„Ÿ", "ä¸æ•æ„Ÿ"],
                values: ["å¾ˆæ•æ„Ÿ", "æ•æ„Ÿ", "ä¸€èˆ¬", "ä¸å¤ªæ•æ„Ÿ", "ä¸æ•æ„Ÿ"]
            },
            {
                text: "æ‚¨çš„ä½“å‹ç‰¹å¾ï¼Ÿ",
                labels: ["å¾ˆç˜¦", "åç˜¦", "æ­£å¸¸", "åèƒ–", "å¾ˆèƒ–"],
                values: ["å¾ˆç˜¦", "åç˜¦", "æ­£å¸¸", "åèƒ–", "å¾ˆèƒ–"]
            },
            {
                text: "æ‚¨çš„çš®è‚¤çŠ¶æ€ï¼Ÿ",
                labels: ["å¹²ç‡¥ç²—ç³™", "è¾ƒå¹²ç‡¥", "ä¸€èˆ¬", "è¾ƒæ²¹è…»", "æ²¹è…»å…‰æ»‘"],
                values: ["å¾ˆå¹²", "è¾ƒå¹²", "ä¸€èˆ¬", "è¾ƒæ²¹", "å¾ˆæ²¹"]
            },
            {
                text: "æ‚¨å¹³æ—¶çš„è¿åŠ¨è€åŠ›ï¼Ÿ",
                labels: ["å¾ˆå®¹æ˜“ç´¯", "å®¹æ˜“ç´¯", "ä¸€èˆ¬", "è€åŠ›è¾ƒå¥½", "è€åŠ›å¾ˆå¥½"],
                values: ["å¾ˆå·®", "è¾ƒå·®", "ä¸€èˆ¬", "è¾ƒå¥½", "å¾ˆå¥½"]
            },
            {
                text: "æ‚¨å¯¹å‹åŠ›çš„æ‰¿å—èƒ½åŠ›ï¼Ÿ",
                labels: ["å¾ˆéš¾æ‰¿å—", "è¾ƒéš¾æ‰¿å—", "ä¸€èˆ¬", "æ‰¿å—åŠ›è¾ƒå¥½", "æ‰¿å—åŠ›å¼º"],
                values: ["å¾ˆå·®", "è¾ƒå·®", "ä¸€èˆ¬", "è¾ƒå¥½", "å¾ˆå¥½"]
            }
        ];

        let currentQuestion = 0;
        let answers = [];
        
        // ä¿å­˜è¿›åº¦åˆ°localStorage
        function saveProgress() {
            try {
                const progressData = {
                    currentQuestion: currentQuestion,
                    answers: answers,
                    timestamp: new Date().toISOString(),
                    completed: false
                };
                localStorage.setItem('quickAssessmentProgress', JSON.stringify(progressData));
                debugLog('è¿›åº¦å·²ä¿å­˜', progressData);
            } catch (error) {
                console.warn('ä¿å­˜è¿›åº¦å¤±è´¥:', error);
            }
        }

        // ä»localStorageæ¢å¤è¿›åº¦
        function restoreProgress() {
            try {
                const savedProgress = localStorage.getItem('quickAssessmentProgress');
                if (savedProgress) {
                    const progressData = JSON.parse(savedProgress);
                    debugLog('æ‰¾åˆ°ä¿å­˜çš„è¿›åº¦', progressData);
                    
                    // æ£€æŸ¥æ˜¯å¦å·²å®Œæˆ
                    if (progressData.completed) {
                        debugLog('æµ‹è¯•å·²å®Œæˆï¼Œæ˜¾ç¤ºç»“æœé€‰é¡¹');
                        if (confirm('æ‚¨å·²å®Œæˆè¿‡è¿™ä¸ªæµ‹è¯•ï¼Œæ˜¯å¦æŸ¥çœ‹ä¹‹å‰çš„ç»“æœï¼Ÿ\nç‚¹å‡»"ç¡®å®š"æŸ¥çœ‹ç»“æœï¼Œç‚¹å‡»"å–æ¶ˆ"é‡æ–°å¼€å§‹æµ‹è¯•ã€‚')) {
                            showPreviousResult();
                            return true;
                        } else {
                            // æ¸…é™¤æ—§æ•°æ®é‡æ–°å¼€å§‹
                            localStorage.removeItem('quickAssessmentProgress');
                            localStorage.removeItem('quickAssessmentResult');
                            return false;
                        }
                    }
                    
                    // æ¢å¤æœªå®Œæˆçš„è¿›åº¦
                    if (progressData.answers && progressData.currentQuestion !== undefined) {
                        if (confirm(`å‘ç°æœªå®Œæˆçš„æµ‹è¯•ï¼ˆè¿›åº¦ï¼š${progressData.currentQuestion + 1}/${questions.length}ï¼‰ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ\nç‚¹å‡»"ç¡®å®š"ç»§ç»­æµ‹è¯•ï¼Œç‚¹å‡»"å–æ¶ˆ"é‡æ–°å¼€å§‹ã€‚`)) {
                            currentQuestion = Math.min(progressData.currentQuestion, questions.length - 1);
                            answers = progressData.answers || [];
                            
                            // ç¡®ä¿ç­”æ¡ˆæ•°ç»„é•¿åº¦æ­£ç¡®
                            while (answers.length < questions.length) {
                                answers.push(3); // é»˜è®¤å€¼
                            }
                            
                            debugLog('è¿›åº¦å·²æ¢å¤', {currentQuestion, answers});
                            return true;
                        } else {
                            localStorage.removeItem('quickAssessmentProgress');
                            return false;
                        }
                    }
                }
                return false;
            } catch (error) {
                console.warn('æ¢å¤è¿›åº¦å¤±è´¥:', error);
                localStorage.removeItem('quickAssessmentProgress');
                return false;
            }
        }

        // æ˜¾ç¤ºä¹‹å‰çš„ç»“æœ
        function showPreviousResult() {
            try {
                const savedResult = localStorage.getItem('quickAssessmentResult');
                if (savedResult) {
                    const resultData = JSON.parse(savedResult);
                    debugLog('æ˜¾ç¤ºä¿å­˜çš„ç»“æœ', resultData);
                    
                    // éšè—é—®å·ç›¸å…³å…ƒç´ ï¼Œä½†ä¿æŒå®¹å™¨å¯è§
                    hideQuestionnaireElements();
                    
                    const resultContainer = safeGetElement('result');
                    if (resultContainer) {
                        resultContainer.classList.remove('hidden');
                        resultContainer.style.display = 'block'; // ç¡®ä¿æ˜¾ç¤º
                    } else {
                        throw new Error('ç»“æœå®¹å™¨æœªæ‰¾åˆ°');
                    }
                    
                    // æ›´æ–°ç»“æœæ˜¾ç¤º
                    const resultIcon = safeGetElement('resultIcon');
                    const resultTitle = safeGetElement('resultTitle');
                    const resultDescription = safeGetElement('resultDescription');
                    
                    if (resultIcon) resultIcon.textContent = resultData.result.icon;
                    if (resultTitle) resultTitle.textContent = resultData.result.title;
                    if (resultDescription) resultDescription.textContent = resultData.result.description;
                    
                    debugLog('ç»“æœæ˜¾ç¤ºå…ƒç´ æ›´æ–°å®Œæˆ');
                    
                    // éªŒè¯ç»“æœå®¹å™¨æ˜¯å¦çœŸçš„å¯è§
                    setTimeout(() => {
                        const container = safeGetElement('result');
                        if (container) {
                            const computedStyle = window.getComputedStyle(container);
                            debugLog('ç»“æœå®¹å™¨æ ·å¼æ£€æŸ¥', {
                                display: computedStyle.display,
                                visibility: computedStyle.visibility,
                                opacity: computedStyle.opacity,
                                position: computedStyle.position,
                                className: container.className,
                                offsetHeight: container.offsetHeight,
                                offsetWidth: container.offsetWidth
                            });
                        }
                    }, 100);
                }
            } catch (error) {
                console.error('æ˜¾ç¤ºä¹‹å‰ç»“æœå¤±è´¥:', error);
                alert('æ— æ³•æ˜¾ç¤ºä¹‹å‰çš„ç»“æœï¼Œè¯·é‡æ–°æµ‹è¯•');
            }
        }

        // åˆå§‹åŒ–
        function init() {
            debugLog('å¼€å§‹åˆå§‹åŒ–');
            
            // å°è¯•æ¢å¤è¿›åº¦
            const restored = restoreProgress();
            
            // ç”Ÿæˆæ‰€æœ‰é—®é¢˜å¹»ç¯ç‰‡
            generateSlides();
            // åˆå§‹åŒ–æ»‘åŠ¨æ¡äº‹ä»¶
            initSliders();
            
            if (restored) {
                // æ¢å¤UIçŠ¶æ€
                updateQuestionDisplay();
            }
            
            // æ›´æ–°è¿›åº¦
            updateProgress();
            
            debugLog('åˆå§‹åŒ–å®Œæˆ');
        }

        // æ›´æ–°é—®é¢˜æ˜¾ç¤ºçŠ¶æ€
        function updateQuestionDisplay() {
            // éšè—æ‰€æœ‰é—®é¢˜
            for (let i = 0; i < questions.length; i++) {
                const slide = safeGetElement(`slide-${i}`);
                if (slide) {
                    slide.classList.remove('active');
                }
            }
            
            // æ˜¾ç¤ºå½“å‰é—®é¢˜
            const currentSlide = safeGetElement(`slide-${currentQuestion}`);
            if (currentSlide) {
                currentSlide.classList.add('active');
            }
            
            // æ¢å¤æ»‘åŠ¨æ¡å€¼
            const slider = safeGetElement(`slider-${currentQuestion}`);
            const valueDisplay = safeGetElement(`value-${currentQuestion}`);
            if (slider && answers[currentQuestion] !== undefined) {
                slider.value = answers[currentQuestion];
                if (valueDisplay) {
                    valueDisplay.textContent = questions[currentQuestion].values[answers[currentQuestion] - 1];
                }
            }
        }

        // ç”Ÿæˆé—®é¢˜å¹»ç¯ç‰‡
        function generateSlides() {
            const container = document.querySelector('.typeform-container');
            
            for (let i = 1; i < questions.length; i++) {
                const question = questions[i];
                const slide = document.createElement('div');
                slide.className = 'question-slide';
                slide.id = `slide-${i}`;
                
                slide.innerHTML = `
                    <h1 class="typeform-question">${question.text}</h1>
                    <p class="typeform-subtitle">è¯·æ ¹æ®æ‚¨æœ€è¿‘ä¸€ä¸ªæœˆçš„å®é™…æƒ…å†µä½œç­”</p>
                    
                    <div class="slider-container">
                        <input type="range" min="1" max="5" value="3" class="custom-slider" id="slider-${i}">
                        <div class="slider-labels">
                            <span>${question.labels[0]}</span>
                            <span>${question.labels[1]}</span>
                            <span>${question.labels[2]}</span>
                            <span>${question.labels[3]}</span>
                            <span>${question.labels[4]}</span>
                        </div>
                        <div class="current-value" id="value-${i}">${question.values[2]}</div>
                    </div>

                    <div class="navigation">
                        <button class="nav-button" onclick="prevQuestion()">
                            <i class="fas fa-arrow-left"></i>
                            ä¸Šä¸€é¢˜
                        </button>
                        <button class="nav-button primary" onclick="nextQuestion()">
                            ${i === questions.length - 1 ? 'æŸ¥çœ‹ç»“æœ' : 'ä¸‹ä¸€é¢˜'}
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                `;
                
                container.insertBefore(slide, document.getElementById('result'));
            }
        }

        // åˆå§‹åŒ–æ»‘åŠ¨æ¡
        function initSliders() {
            questions.forEach((question, index) => {
                const slider = safeGetElement(`slider-${index}`);
                const valueDisplay = safeGetElement(`value-${index}`);
                
                if (slider && valueDisplay) {
                    slider.addEventListener('input', function() {
                        const value = parseInt(this.value);
                        valueDisplay.textContent = question.values[value - 1];
                        answers[index] = value;
                        
                        // ä¿å­˜è¿›åº¦
                        saveProgress();
                        debugLog(`é—®é¢˜${index + 1}ç­”æ¡ˆå·²æ›´æ–°`, {question: index, answer: value});
                    });
                    
                    // è®¾ç½®åˆå§‹å€¼ï¼ˆå¦‚æœæ²¡æœ‰æ¢å¤çš„å€¼ï¼‰
                    if (answers[index] === undefined) {
                        answers[index] = 3;
                        slider.value = 3;
                        valueDisplay.textContent = question.values[2]; // ç´¢å¼•2å¯¹åº”å€¼3
                    }
                }
            });
            
            debugLog('æ»‘åŠ¨æ¡åˆå§‹åŒ–å®Œæˆ', answers);
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            try {
                debugLog('ä¸‹ä¸€é¢˜', {current: currentQuestion, total: questions.length});
                
                if (currentQuestion < questions.length - 1) {
                    // éšè—å½“å‰é—®é¢˜
                    const currentSlide = safeGetElement(`slide-${currentQuestion}`);
                    if (currentSlide) currentSlide.classList.remove('active');
                    
                    currentQuestion++;
                    
                    // æ˜¾ç¤ºä¸‹ä¸€é¢˜
                    const nextSlide = safeGetElement(`slide-${currentQuestion}`);
                    if (nextSlide) nextSlide.classList.add('active');
                    
                    // ä¿å­˜è¿›åº¦
                    saveProgress();
                    updateProgress();
                } else {
                    // æ˜¾ç¤ºç»“æœ
                    const currentSlide = safeGetElement(`slide-${currentQuestion}`);
                    if (currentSlide) currentSlide.classList.remove('active');
                    
                    debugLog('å‡†å¤‡æ˜¾ç¤ºç»“æœ');
                    showResult();
                }
            } catch (error) {
                console.error('ä¸‹ä¸€é¢˜æ—¶å‡ºé”™:', error);
                alert('åˆ‡æ¢é¢˜ç›®æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // ä¸Šä¸€é¢˜
        function prevQuestion() {
            try {
                debugLog('ä¸Šä¸€é¢˜', {current: currentQuestion});
                
                if (currentQuestion > 0) {
                    // éšè—å½“å‰é—®é¢˜
                    const currentSlide = safeGetElement(`slide-${currentQuestion}`);
                    if (currentSlide) currentSlide.classList.remove('active');
                    
                    currentQuestion--;
                    
                    // æ˜¾ç¤ºä¸Šä¸€é¢˜
                    const prevSlide = safeGetElement(`slide-${currentQuestion}`);
                    if (prevSlide) prevSlide.classList.add('active');
                    
                    // ä¿å­˜è¿›åº¦
                    saveProgress();
                    updateProgress();
                }
            } catch (error) {
                console.error('ä¸Šä¸€é¢˜æ—¶å‡ºé”™:', error);
                alert('åˆ‡æ¢é¢˜ç›®æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
            }
        }

        // æ›´æ–°è¿›åº¦
        function updateProgress() {
            const progress = ((currentQuestion + 1) / questions.length) * 100;
            const progressCircle = document.getElementById('progressCircle');
            const progressText = document.getElementById('progressText');
            
            progressCircle.style.background = `conic-gradient(#ffffff ${progress * 3.6}deg, transparent ${progress * 3.6}deg)`;
            progressText.textContent = `${currentQuestion + 1}/${questions.length}`;
            
            if (currentQuestion >= questions.length) {
                progressText.textContent = 'å®Œæˆ';
                progressCircle.style.background = 'conic-gradient(#ffffff 360deg, transparent 360deg)';
            }
        }
        
        // æ˜¾ç¤ºç»“æœ
        function showResult() {
            try {
                debugLog('å¼€å§‹æ˜¾ç¤ºç»“æœ', {answersLength: answers.length, answers: answers});
                
                // éªŒè¯ç­”æ¡ˆå®Œæ•´æ€§
                if (!answers || answers.length !== questions.length) {
                    throw new Error(`ç­”æ¡ˆæ•°æ®ä¸å®Œæ•´: ${answers?.length}/${questions.length}`);
                }
                
                // è®¡ç®—ä½“è´¨ç±»å‹
                const result = calculateConstitution();
                debugLog('è®¡ç®—ç»“æœå®Œæˆ', result);
                
                // éšè—é—®å·ç›¸å…³å…ƒç´ ï¼Œä½†ä¿æŒå®¹å™¨å¯è§
                hideQuestionnaireElements();
                
                // å®‰å…¨åœ°æ˜¾ç¤ºç»“æœå®¹å™¨
                const resultContainer = safeGetElement('result');
                if (resultContainer) {
                    resultContainer.classList.remove('hidden');
                    resultContainer.style.display = 'block'; // ç¡®ä¿æ˜¾ç¤º
                } else {
                    throw new Error('ç»“æœå®¹å™¨æœªæ‰¾åˆ°');
                }
                
                // å®‰å…¨åœ°æ›´æ–°ç»“æœæ˜¾ç¤º
                const resultIcon = safeGetElement('resultIcon');
                const resultTitle = safeGetElement('resultTitle');
                const resultDescription = safeGetElement('resultDescription');
                
                if (resultIcon) resultIcon.textContent = result.icon;
                if (resultTitle) resultTitle.textContent = result.title;
                if (resultDescription) resultDescription.textContent = result.description;
                
                // ä¿å­˜ç»“æœåˆ°æœ¬åœ°å­˜å‚¨
                const resultData = {
                    answers: answers,
                    result: result,
                    timestamp: new Date().toISOString(),
                    completed: true
                };
                
                localStorage.setItem('quickAssessmentResult', JSON.stringify(resultData));
                localStorage.setItem('quickAssessmentProgress', JSON.stringify({
                    currentQuestion: questions.length,
                    answers: answers,
                    completed: true,
                    timestamp: new Date().toISOString()
                }));
                
                debugLog('ç»“æœæ˜¾ç¤ºå®Œæˆ');
                
            } catch (error) {
                console.error('æ˜¾ç¤ºç»“æœæ—¶å‡ºé”™:', error);
                alert('è®¡ç®—ç»“æœæ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•ã€‚é”™è¯¯ä¿¡æ¯ï¼š' + error.message);
            }
        }
        
        // è®¡ç®—ä½“è´¨ç±»å‹ï¼ˆç®€åŒ–ç‰ˆï¼‰
        function calculateConstitution() {
            try {
                debugLog('å¼€å§‹è®¡ç®—ä½“è´¨ç±»å‹', answers);
                
                // éªŒè¯ç­”æ¡ˆæ•°æ®
                if (!answers || !Array.isArray(answers) || answers.length === 0) {
                    throw new Error('ç­”æ¡ˆæ•°æ®æ— æ•ˆ');
                }
                
                // è¿‡æ»¤æœ‰æ•ˆç­”æ¡ˆï¼ˆæ’é™¤undefinedå’Œnullï¼‰
                const validAnswers = answers.filter(answer => answer != null && !isNaN(answer));
                if (validAnswers.length === 0) {
                    throw new Error('æ²¡æœ‰æœ‰æ•ˆçš„ç­”æ¡ˆæ•°æ®');
                }
                
                const totalScore = validAnswers.reduce((sum, answer) => sum + Number(answer), 0);
                const avgScore = totalScore / validAnswers.length;
                
                debugLog('è®¡ç®—å¾—åˆ†', {totalScore, avgScore, validAnswersCount: validAnswers.length});
                
                // ç®€åŒ–çš„ä½“è´¨åˆ¤æ–­é€»è¾‘
                if (avgScore >= 4.2) {
                return {
                    icon: 'ğŸŒŸ',
                    title: 'å¹³å’Œè´¨å€¾å‘',
                    description: 'æ‚¨çš„ä½“è´¨ç›¸å¯¹å¹³è¡¡ï¼Œç²¾åŠ›å……æ²›ï¼Œé€‚åº”èƒ½åŠ›è¾ƒå¼ºã€‚å»ºè®®ç»§ç»­ä¿æŒè‰¯å¥½çš„ç”Ÿæ´»ä¹ æƒ¯ï¼Œå®šæœŸè¿›è¡Œæ›´è¯¦ç»†çš„ä½“è´¨è¯„ä¼°ä»¥è·å¾—ä¸ªæ€§åŒ–å»ºè®®ã€‚'
                };
            } else if (avgScore <= 2.8) {
                return {
                    icon: 'ğŸ’¤',
                    title: 'æ°”è™šè´¨å€¾å‘',
                    description: 'æ‚¨å¯èƒ½å­˜åœ¨æ°”è™šçš„è¡¨ç°ï¼Œå®¹æ˜“ç–²å€¦ï¼ŒæŠµæŠ—åŠ›è¾ƒå¼±ã€‚å»ºè®®æ³¨æ„ä¼‘æ¯ï¼Œé€‚å½“è¿åŠ¨ï¼Œå¹¶è¿›è¡Œè¯¦ç»†è¯„ä¼°ä»¥è·å¾—é’ˆå¯¹æ€§çš„è°ƒç†å»ºè®®ã€‚'
                };
                } else if (validAnswers.length > 2 && validAnswers[2] <= 2) { // æ€•å†·
                    return {
                        icon: 'â„ï¸',
                        title: 'é˜³è™šè´¨å€¾å‘',
                        description: 'æ‚¨å¯èƒ½æœ‰é˜³è™šçš„ç‰¹å¾ï¼Œå®¹æ˜“æ€•å†·ï¼Œæ‰‹è„šå‡‰ã€‚å»ºè®®æ³¨æ„ä¿æš–ï¼Œé€‚å½“è¿›è¡Œæ¸©é˜³çš„è°ƒç†ï¼Œå¹¶è¿›è¡Œè¯¦ç»†è¯„ä¼°è·å¾—ä¸“ä¸šå»ºè®®ã€‚'
                    };
                } else if (validAnswers.length > 2 && validAnswers[2] >= 4) { // æ€•çƒ­
                    return {
                        icon: 'ğŸ”¥',
                        title: 'é˜´è™šè´¨å€¾å‘',
                        description: 'æ‚¨å¯èƒ½æœ‰é˜´è™šçš„è¡¨ç°ï¼Œå®¹æ˜“ä¸Šç«ï¼Œæ€•çƒ­ã€‚å»ºè®®æ³¨æ„æ»‹é˜´æ¶¦ç‡¥ï¼Œé¿å…ç†¬å¤œï¼Œå¹¶è¿›è¡Œè¯¦ç»†è¯„ä¼°è·å¾—ä¸ªæ€§åŒ–è°ƒç†æ–¹æ¡ˆã€‚'
                    };
                } else {
                    return {
                        icon: 'âš–ï¸',
                        title: 'ä½“è´¨å¾…è¿›ä¸€æ­¥è¯„ä¼°',
                        description: 'æ ¹æ®å¿«é€Ÿç­›æŸ¥ç»“æœï¼Œæ‚¨çš„ä½“è´¨ç‰¹å¾éœ€è¦æ›´è¯¦ç»†çš„åˆ†æã€‚å»ºè®®è¿›è¡Œæ ‡å‡†è¯„ä¼°ï¼Œä»¥è·å¾—æ›´å‡†ç¡®çš„ä½“è´¨åˆ¤æ–­å’Œè°ƒç†å»ºè®®ã€‚'
                    };
                }
                
            } catch (error) {
                console.error('è®¡ç®—ä½“è´¨ç±»å‹æ—¶å‡ºé”™:', error);
                // è¿”å›é»˜è®¤ç»“æœ
                return {
                    icon: 'â“',
                    title: 'è®¡ç®—å‡ºç°é—®é¢˜',
                    description: 'ä½“è´¨è®¡ç®—è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œå»ºè®®é‡æ–°è¿›è¡Œæµ‹è¯•ã€‚å¦‚é—®é¢˜æŒç»­å­˜åœ¨ï¼Œè¯·è”ç³»æŠ€æœ¯æ”¯æŒã€‚'
                };
            }
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
